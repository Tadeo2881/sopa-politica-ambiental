<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sopa de Letras – Política Ambiental</title>

<style>
  body{font-family:Arial, sans-serif; background:#f4f6fb; margin:0; padding:18px; text-align:center;}
  h1{color:#1b2a4a; margin:0 0 8px;}
  p{margin:6px 0 10px;}

  .toolbar{display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap;}
  button{padding:8px 14px; border:1px solid #cfd6e6; background:white; border-radius:10px; cursor:pointer;}
  button:hover{background:#eef2ff;}
  .count{font-weight:800;}

  .grid{
    display:grid;
    grid-template-columns:repeat(15, 34px);
    gap:6px;
    justify-content:center;
    margin:18px auto 10px;
    padding:10px;
  }
  .cell{
    width:34px; height:34px;
    border:1px solid #cfd6e6;
    display:flex; align-items:center; justify-content:center;
    font-weight:800; cursor:pointer;
    background:white; border-radius:6px;
    user-select:none;
  }
  .cell.selected{background:#ffe08a;}
  .cell.found{background:#2ecc71; color:white;}

  .qaWrap{
    max-width:980px;
    margin:18px auto;
    background:white;
    border:1px solid #dbe3f6;
    border-radius:14px;
    padding:14px;
    text-align:left;
  }
  table{width:100%; border-collapse:collapse; table-layout:fixed;}
  th, td{border:1px solid #e6ebf7; padding:10px; vertical-align:top; font-size:14px;}
  th{background:#f0f4ff; color:#1b2a4a; text-align:left;}
  td.question{width:70%;}
  td.answer{width:30%; text-align:center; font-weight:900; letter-spacing:.6px;}

  /* Respuesta en “rayas” */
  .slot{
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:28px;
    border-bottom:2px solid #333;
    padding:2px 6px;
  }
  .slot span{display:inline-block; padding:2px 6px;}
  .slot.ok{border-bottom-color:#1c7c39;}
  .slot.ok span{color:#1c7c39;}

  /* Opcional: al acertar, bloquear el selector */
  select{
    width:100%;
    padding:7px 10px;
    border-radius:10px;
    border:1px solid #cfd6e6;
    background:white;
    font-weight:800;
    letter-spacing:.4px;
  }
  .locked{
    background:#eaf7ef !important;
    border-color:#bfe7cd !important;
    color:#1c7c39 !important;
  }
</style>
</head>

<body>
  <h1>Sopa de Letras – Política Ambiental</h1>
  <p>Selecciona letras con <b>clic + arrastrar</b> en línea recta (horizontal/vertical/diagonal).</p>

  <div class="toolbar">
    <button id="resetBtn">Reiniciar</button>
    <div class="count">Encontradas: <span id="count">0</span> / <span id="total">0</span></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="qaWrap">
    <h2 style="margin:0 0 10px;">Preguntas y respuestas (desordenadas)</h2>
    <table>
      <thead>
        <tr>
          <th>Pregunta</th>
          <th>Respuesta (elige una)</th>
        </tr>
      </thead>
      <tbody id="qaBody"></tbody>
    </table>
  </div>

<script>
  // ====== PREGUNTAS (FIJAS) + RESPUESTA CORRECTA (PALABRA) ======
  const QA = [
    { q:"1. Conjunto de decisiones del Estado.", a:"POLITICA" },
    { q:"2. Relacionado con el entorno natural.", a:"AMBIENTAL" },
    { q:"3. Vía donde se crean leyes.", a:"LEGISLATIVA" },
    { q:"4. Proceso de establecer metas.", a:"PLANEACION" },
    { q:"5. Obligación de responder por daños.", a:"RESPONSABILIDAD" },
    { q:"6. Responsabilidad basada en leyes.", a:"JURIDICA" },
    { q:"7. Actuar correctamente moralmente.", a:"ETICA" },
    { q:"8. Compromiso de la sociedad.", a:"SOCIAL" },
    { q:"9. Instrumento económico ambiental.", a:"IMPUESTO" },
    { q:"10. Castigo por incumplimiento.", a:"SANCION" }
  ];

  // ====== SOPA ======
  const size = 15;
  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const gridEl = document.getElementById("grid");
  const qaBody = document.getElementById("qaBody");
  const countEl = document.getElementById("count");
  const totalEl = document.getElementById("total");
  const resetBtn = document.getElementById("resetBtn");

  totalEl.textContent = QA.length;

  // ---- util: shuffle ----
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ====== 1) Respuestas visibles pero DESORDENADAS (cambian cada inicio) ======
  const answersShuffled = shuffle(QA.map(x=>x.a));

  // Render tabla: pregunta fija + un SELECT con respuestas en orden aleatorio
  QA.forEach((item, idx) => {
    const tr = document.createElement("tr");

    const tdQ = document.createElement("td");
    tdQ.className = "question";
    tdQ.textContent = item.q;

    const tdA = document.createElement("td");
    tdA.className = "answer";

    const sel = document.createElement("select");
    sel.id = "sel-" + item.a;

    // opción por defecto (rayas)
    const opt0 = document.createElement("option");
    opt0.value = "";
    opt0.textContent = "__________";
    sel.appendChild(opt0);

    // opciones desordenadas
    answersShuffled.forEach(w=>{
      const opt = document.createElement("option");
      opt.value = w;
      opt.textContent = w;
      sel.appendChild(opt);
    });

    tdA.appendChild(sel);
    tr.appendChild(tdQ);
    tr.appendChild(tdA);
    qaBody.appendChild(tr);
  });

  // ====== 2) Cuadrícula (letras random) ======
  const cells = [];
  for(let r=0; r<size; r++){
    for(let c=0; c<size; c++){
      const div = document.createElement("div");
      div.className = "cell";
      div.dataset.r = r;
      div.dataset.c = c;
      div.textContent = letters[Math.floor(Math.random()*letters.length)];
      gridEl.appendChild(div);
      cells.push(div);
    }
  }

  // ====== 3) Lógica de selección por arrastre ======
  let isDragging=false, startCell=null, selectedPath=[];
  const found = new Set();

  function getCell(r,c){
    return gridEl.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);
  }
  function clearSelection(){
    selectedPath.forEach(el=>el.classList.remove("selected"));
    selectedPath=[];
  }
  function linePath(a,b){
    const ar=+a.dataset.r, ac=+a.dataset.c;
    const br=+b.dataset.r, bc=+b.dataset.c;
    const dr=br-ar, dc=bc-ac;

    const ok=(dr===0)||(dc===0)||(Math.abs(dr)===Math.abs(dc));
    if(!ok) return [];

    const stepR=dr===0?0:dr/Math.abs(dr);
    const stepC=dc===0?0:dc/Math.abs(dc);
    const len=Math.max(Math.abs(dr),Math.abs(dc))+1;

    const path=[];
    let r=ar, c=ac;
    for(let i=0;i<len;i++){
      const cell=getCell(r,c);
      if(cell) path.push(cell);
      r+=stepR; c+=stepC;
    }
    return path;
  }
  function selectionString(path){
    return path.map(el=>el.textContent).join("");
  }

  function tryMatch(){
    if(selectedPath.length<2) return;

    const s1 = selectionString(selectedPath);
    const s2 = s1.split("").reverse().join("");

    for(const item of QA){
      const w=item.a;
      if(found.has(w)) continue;
      if(s1.includes(w) || s2.includes(w)){
        found.add(w);

        // marcar verde en sopa
        selectedPath.forEach(el=>{
          el.classList.remove("selected");
          el.classList.add("found");
        });

        // ✅ marcar respuesta correcta: seleccionar automáticamente su palabra y bloquear
        const sel = document.getElementById("sel-"+w);
        if(sel){
          sel.value = w;           // pone la respuesta en su “raya”
          sel.classList.add("locked");
          sel.disabled = true;     // bloquea (opcional)
        }

        countEl.textContent = found.size;
        break;
      }
    }
  }

  cells.forEach(cell=>{
    cell.addEventListener("mousedown",(e)=>{
      e.preventDefault();
      isDragging=true;
      startCell=cell;
      clearSelection();
      selectedPath=[cell];
      if(!cell.classList.contains("found")) cell.classList.add("selected");
    });

    cell.addEventListener("mouseenter",()=>{
      if(!isDragging||!startCell) return;
      clearSelection();
      const path=linePath(startCell, cell);
      selectedPath=path;
      selectedPath.forEach(el=>{
        if(!el.classList.contains("found")) el.classList.add("selected");
      });
    });

    cell.addEventListener("mouseup",()=>{
      if(!isDragging) return;
      isDragging=false;
      tryMatch();
      clearSelection();
      startCell=null;
    });
  });

  document.addEventListener("mouseup",()=>{
    if(isDragging){
      isDragging=false;
      tryMatch();
      clearSelection();
      startCell=null;
    }
  });

  // Reiniciar (recarga)
  resetBtn.addEventListener("click", ()=> location.reload());
</script>

</body>
</html>
